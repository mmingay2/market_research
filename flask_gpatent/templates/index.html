{% extends "base.html" %}

{% block title %}Patent Viewer{% endblock %}

{% block content %}
<!-- Search Section -->
<div class="search-container">
    <form id="searchForm" method="POST" action="{{ url_for('search_patent') }}">
        <div class="search-form">
            <input type="text" 
                   class="search-input" 
                   name="patent_id" 
                   placeholder="Enter patent ID (e.g., US20210129107)"
                   required>
            <button class="search-button" type="submit">
                Search
            </button>
        </div>
    </form>
    
    <!-- Loading Spinner -->
    <div id="loading" class="loading">
        <div class="spinner"></div>
        <p>Searching for patent information...</p>
    </div>
</div>

<!-- Patents Section -->
{% if patent_files %}
    <div class="patent-grid">
        {% for patent in patent_files %}
            <div class="patent-card" onclick="window.location.href='{{ url_for('view_patent', filename=patent.filename) }}'">
                <div class="patent-id">{{ patent.patent_id }}</div>
                <div class="patent-title">{{ patent.title[:80] }}{% if patent.title|length > 80 %}...{% endif %}</div>
                <div class="patent-meta">
                    <span>{{ patent.scraped_at.split('T')[0] if patent.scraped_at != 'Unknown' else 'Unknown' }}</span>
                    <div>
                        <a href="{{ url_for('view_patent', filename=patent.filename) }}" 
                           class="btn btn-primary">View</a>
                        <button class="btn btn-danger" 
                                onclick="event.stopPropagation(); confirmDelete('{{ patent.filename }}', '{{ patent.patent_id }}');">
                            Delete
                        </button>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% else %}
    <div class="empty-state">
        <h3>No patents found</h3>
        <p>Search for a patent to get started</p>
    </div>
{% endif %}

<!-- Delete Confirmation Modal -->
<div id="deleteModal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 2rem; border-radius: 12px; max-width: 400px; width: 90%;">
        <h3 style="margin-bottom: 1rem;">Confirm Delete</h3>
        <p style="margin-bottom: 1.5rem; color: var(--text-secondary);">Are you sure you want to delete patent <strong id="deletePatentId"></strong>?</p>
        <div style="display: flex; gap: 1rem; justify-content: flex-end;">
            <button class="btn btn-secondary" onclick="closeDeleteModal()">Cancel</button>
            <form id="deleteForm" method="POST" style="display: inline;">
                <button type="submit" class="btn btn-danger">Delete</button>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function confirmDelete(filename, patentId) {
    document.getElementById('deletePatentId').textContent = patentId;
    document.getElementById('deleteForm').action = "{{ url_for('delete_patent', filename='') }}" + filename;
    document.getElementById('deleteModal').style.display = 'block';
}

function closeDeleteModal() {
    document.getElementById('deleteModal').style.display = 'none';
}

// Close modal when clicking outside
document.getElementById('deleteModal').addEventListener('click', function(e) {
    if (e.target === this) {
        closeDeleteModal();
    }
});
</script>
{% endblock %} 